local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer

-- === DEFAULT SETTINGS ===
local DefaultSettings = {
	Distance = 100,
	Color = Color3.fromRGB(255, 255, 255),
	UsePlayerColor = false,
	Active = false,
	Transparency = 0.3,
	HighlightR6 = true,
	HighlightR15 = true
}

local HighlightSettings = table.clone(DefaultSettings)

local R6BodyParts = {"Head","Torso","Left Arm","Right Arm","Left Leg","Right Leg"}

local R15BodyParts = {
	"Head","UpperTorso","LowerTorso","LeftUpperArm","LeftLowerArm","LeftHand",
	"RightUpperArm","RightLowerArm","RightHand","LeftUpperLeg","LeftLowerLeg",
	"LeftFoot","RightUpperLeg","RightLowerLeg","RightFoot"
}

local BodyHighlights = {}

-- === AVATAR TYPE ===
local function GetAvatarType(character)
	if character and character:FindFirstChild("Humanoid") then
		return character.Humanoid.RigType == Enum.HumanoidRigType.R6 and "R6" or "R15"
	end
	return "Unknown"
end

-- === CLEAR ALL ===
local function ClearAllHighlights()
	for character, highlights in pairs(BodyHighlights) do
		for _, h in pairs(highlights) do
			if h then h:Destroy() end
		end
	end
	BodyHighlights = {}
end

-- === CREATE HIGHLIGHT ===
local function CreateBodyHighlight(character)
	if not character or not HighlightSettings.Active then return end
	
	local avatarType = GetAvatarType(character)

	if (avatarType == "R6" and not HighlightSettings.HighlightR6) or
	   (avatarType == "R15" and not HighlightSettings.HighlightR15) then
		return
	end
	
	local parts = avatarType == "R6" and R6BodyParts or R15BodyParts
	local highlights = {}

	local color = HighlightSettings.UsePlayerColor
		and character:FindFirstChild("Head")
		and character.Head.Color
		or HighlightSettings.Color

	for _, partName in pairs(parts) do
		local part = character:FindFirstChild(partName)
		if part then
			local highlight = Instance.new("BoxHandleAdornment")
			highlight.Adornee = part
			highlight.AlwaysOnTop = true
			highlight.Size = part.Size * 1.05
			highlight.Transparency = HighlightSettings.Transparency
			highlight.Color3 = color
			highlight.ZIndex = 5
			highlight.Parent = part
			table.insert(highlights, highlight)
		end
	end

	BodyHighlights[character] = highlights
end

-- === UPDATE ALL ===
local function UpdateAll()
	ClearAllHighlights()
	if HighlightSettings.Active then
		for _, player in ipairs(Players:GetPlayers()) do
			if player ~= LocalPlayer and player.Character then
				CreateBodyHighlight(player.Character)
			end
		end
	end
end

-- === RESET FUNCTION ===
local function ResetHighlight()
	ClearAllHighlights()
	HighlightSettings = table.clone(DefaultSettings)
	
	-- UI UPDATE
	ToggleButton.Text = "OFF"
	ToggleButton.BackgroundColor3 = Color3.fromRGB(170,0,0)
	
	R6Button.Text = "R6: ON"
	R6Button.BackgroundColor3 = Color3.fromRGB(0,170,0)
	
	R15Button.Text = "R15: ON"
	R15Button.BackgroundColor3 = Color3.fromRGB(0,170,0)
	
	SkinColorButton.Text = "Use Player Color"
	
	ColorButton.BackgroundColor3 = HighlightSettings.Color
	
	DistanceLabel.Text = "Distance: "..HighlightSettings.Distance
	SliderFill.Size = UDim2.new(HighlightSettings.Distance/500,0,1,0)
	SliderHandle.Position = UDim2.new(HighlightSettings.Distance/500,-7,0.5,-7)
end

-- === GUI ===
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.CoreGui

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0,250,0,280)
MainFrame.Position = UDim2.new(0.5,-125,0.5,-140)
MainFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Parent = ScreenGui

Instance.new("UICorner",MainFrame).CornerRadius = UDim.new(0,6)

local Content = Instance.new("Frame")
Content.Size = UDim2.new(1,-10,1,-10)
Content.Position = UDim2.new(0,5,0,5)
Content.BackgroundTransparency = 1
Content.Parent = MainFrame

-- Toggle
ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(1,0,0,30)
ToggleButton.BackgroundColor3 = Color3.fromRGB(170,0,0)
ToggleButton.Text = "OFF"
ToggleButton.TextColor3 = Color3.new(1,1,1)
ToggleButton.Parent = Content

-- Reset Button
ResetButton = Instance.new("TextButton")
ResetButton.Size = UDim2.new(1,0,0,30)
ResetButton.Position = UDim2.new(0,0,0,40)
ResetButton.BackgroundColor3 = Color3.fromRGB(255,120,0)
ResetButton.Text = "RESET"
ResetButton.TextColor3 = Color3.new(1,1,1)
ResetButton.Parent = Content

-- R6
R6Button = Instance.new("TextButton")
R6Button.Size = UDim2.new(0.48,0,0,30)
R6Button.Position = UDim2.new(0,0,0,80)
R6Button.BackgroundColor3 = Color3.fromRGB(0,170,0)
R6Button.Text = "R6: ON"
R6Button.TextColor3 = Color3.new(1,1,1)
R6Button.Parent = Content

-- R15
R15Button = Instance.new("TextButton")
R15Button.Size = UDim2.new(0.48,0,0,30)
R15Button.Position = UDim2.new(0.52,0,0,80)
R15Button.BackgroundColor3 = Color3.fromRGB(0,170,0)
R15Button.Text = "R15: ON"
R15Button.TextColor3 = Color3.new(1,1,1)
R15Button.Parent = Content

-- === BUTTON EVENTS ===
ToggleButton.MouseButton1Click:Connect(function()
	HighlightSettings.Active = not HighlightSettings.Active
	ToggleButton.Text = HighlightSettings.Active and "ON" or "OFF"
	ToggleButton.BackgroundColor3 = HighlightSettings.Active and Color3.fromRGB(0,170,0) or Color3.fromRGB(170,0,0)
	UpdateAll()
end)

R6Button.MouseButton1Click:Connect(function()
	HighlightSettings.HighlightR6 = not HighlightSettings.HighlightR6
	R6Button.Text = "R6: "..(HighlightSettings.HighlightR6 and "ON" or "OFF")
	R6Button.BackgroundColor3 = HighlightSettings.HighlightR6 and Color3.fromRGB(0,170,0) or Color3.fromRGB(170,0,0)
	UpdateAll()
end)

R15Button.MouseButton1Click:Connect(function()
	HighlightSettings.HighlightR15 = not HighlightSettings.HighlightR15
	R15Button.Text = "R15: "..(HighlightSettings.HighlightR15 and "ON" or "OFF")
	R15Button.BackgroundColor3 = HighlightSettings.HighlightR15 and Color3.fromRGB(0,170,0) or Color3.fromRGB(170,0,0)
	UpdateAll()
end)

ResetButton.MouseButton1Click:Connect(function()
	ResetHighlight()
end)

-- === KEYBINDS RESET ===
UserInputService.InputBegan:Connect(function(input, gp)
	if gp then return end
	
	if input.KeyCode == Enum.KeyCode.R
	or input.KeyCode == Enum.KeyCode.RightShift
	or input.KeyCode == Enum.KeyCode.M
	or input.KeyCode == Enum.KeyCode.LeftAlt
	or input.KeyCode == Enum.KeyCode.RightAlt then
		
		ResetHighlight()
	end
end)

print("Highlight Loaded With RESET + Keybinds")
